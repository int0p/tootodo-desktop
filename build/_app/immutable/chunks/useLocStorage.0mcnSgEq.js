import{d as _,w as m}from"./index.CYC7l4Lj.js";import{r as $,p as T,l as b,g as w,d as v}from"./schema.CfVBnZLq.js";import{g as u}from"./entry.CO2krkw7.js";const A=()=>{let t={email:"",id:0,name:"",photo:"",provider:"",role:"",updatedAt:"",verified:!1,createdAt:""};const{subscribe:o,set:r}=m({...t}),n=async e=>{const s=$.safeParse(e);if(!s.success){alert("입력 데이터가 유효하지 않습니다: "+s.error.message);return}try{const a={path:"/auth/register",data:s.data};await T(a),alert("가입이 완료되었습니다. "),u("/login",{replaceState:!0})}catch(a){alert(a.message)}},l=async e=>{const s=b.safeParse(e);if(!s.success){alert("입력 데이터가 유효하지 않습니다: "+s.error.message);return}try{const a={path:"/auth/login",data:s.data};await T(a),i(),f.set(!0),alert("로그인이 완료되었습니다."),u("/do")}catch(a){alert(a.message),u("/login",{replaceState:!0})}},c=async e=>{const s="https://accounts.google.com/o/oauth2/v2/auth";try{const a={redirect_uri:"http://localhost:5173/login",client_id:"192138958436-lp4475kdr9c2d4ltd5em21qhddbukgh7.apps.googleusercontent.com",access_type:"offline",response_type:"code",prompt:"consent",scope:["https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/userinfo.email"].join(" "),state:e},y=new URLSearchParams(a);return`${s}?${y.toString()}`}catch(a){alert("구글 로그인시 오류가 발생했습니다. 로그인을 다시시도해 주세요."+a)}},i=async()=>{const e={path:"/users/me"};try{const a=(await w(e)).data.user;r({...a,verified:!0})}catch{await d()}},g=()=>r({...t}),p=async()=>{const e={path:"/auth/logout"};try{await v(e),r({...t}),f.set(!1),alert("로그아웃이 완료되었습니다."),u("/login",{replaceState:!0})}catch(s){alert(s.message),await refreshWithFn(p)}},S=async()=>{try{const e=new URLSearchParams(window.location.search),s=e.get("code"),a=e.get("state"),y={path:`/sessions/oauth/google?code=${s}&state=${a}`};await w(y),console.log("구글 로그인 완료"),alert("구글 로그인 완료"),f.set(!0),u("/do"),i()}catch(e){alert("구글 로그인시 오류가 발생했습니다. "+e),u("/login",{replaceState:!0})}},d=async()=>{try{await w({path:"/auth/refresh"}),f.set(!0)}catch(e){f.set(!1),alert("refresh token 역시 만료되었습니다. 다시 로그인하세요. "+e),u("/login",{replaceState:!0})}};return{subscribe:o,refresh:d,login:l,getGoogleUrl:c,logout:p,resetUserInfo:g,register:n,googleLogin:S,getUserInfo:i}},I=A(),D=_(I,t=>!!t.verified),f=m(!1);function M(t={}){let o=t.initial??null,r=null,n=t.delay??1e3;const l=m(!1),c=m(o,()=>(t.disabled||i(),()=>g()));function i(){g(),r=setInterval(()=>{c.update(e=>{var s;return((s=t.onTick)==null?void 0:s.call(t,e))??new Date})},n),l.set(!0)}function g(){r&&clearInterval(r),r=null,l.set(!1)}function p(){return c.set(o)}function S(){return n}function d(e){g(),n=e,i()}return{...c,start:i,stop:g,reset:p,isRunning:l,getDelay:S,setDelay:d}}function L(t){if(!t)return"--:--";const o=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0");return`${o}:${r}`}function O(t){if(!t)return"__ --:-- ";const o=t.getHours()>=12?"PM":"AM",r=t.getHours().toString().padStart(2,"0"),n=t.getMinutes().toString().padStart(2,"0");return`${o} ${r}:${n}`}function R(t){if(!t)return"____-__-__";const o=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0");return`${o}-${r}-${n}`}const F=M();function h(t,o){let r=JSON.stringify,n=JSON.parse;if(typeof window<"u"){let l=n(localStorage.getItem(t)),c=m(l||o);return c.subscribe(i=>localStorage.setItem(t,r(i))),c}else return m(o)}const H=h("timerOpen",!1),j=h("timerStopTime",0),q=h("timerSetting",{working:25,breaking:5,cycles:[{startTime:"",endTime:"",done:!1,leftTime:25,studyTime:0},{startTime:"",endTime:"",done:!1,leftTime:25,studyTime:0},{startTime:"",endTime:"",done:!1,leftTime:25,studyTime:0}],remain:5,duration:90,startTime:"",endTime:"",projectColor:"#3f3f46"}),z=h("timerStatus",{play:!0,workSession:!0,cycle:0,startTime:"",endTime:"",leftTime:0,studyTime:0,stopTime:0});export{I as a,q as b,z as c,F as d,j as e,L as f,O as g,R as h,D as i,H as t};
